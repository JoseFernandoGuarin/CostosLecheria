<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Costos - Hacienda La Monta√±a</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ==================== VARIABLES ==================== */
    :root {
      --verde-udea: #006341;
      --verde-claro: #00854d;
      --verde-oscuro: #004a2f;
      --crema: #f8f6f0;
      --gris-claro: #e8e6e0;
      --gris-medio: #6b7280;
      --negro: #1a1a1a;
      --blanco: #ffffff;
      
      /* ‚≠ê NUEVO: Variables adicionales para el m√≥dulo de inventario */
      --azul: #3b82f6;
      --amarillo: #f59e0b;
      --rojo: #ef4444;
      /* Fin de variables nuevas */
      
      --sombra: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --sombra-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      
      --font-display: 'Crimson Pro', serif;
      --font-body: 'Work Sans', sans-serif;
    }

    /* ==================== RESET & BASE ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: var(--crema);
      color: var(--negro);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* ==================== HEADER ==================== */
    .header {
      background: linear-gradient(135deg, var(--verde-udea) 0%, var(--verde-oscuro) 100%);
      color: var(--blanco);
      padding: 2rem 2rem 3rem;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
      pointer-events: none;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 2rem;
    }

    .logos {
      display: flex;
      align-items: center;
      gap: 2rem;
      flex-wrap: wrap;
    }

    .logo-container {
      background: var(--blanco);
      padding: 0.75rem 1.25rem;
      border-radius: 12px;
      box-shadow: var(--sombra);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: transform 0.3s ease;
    }

    .logo-container:hover {
      transform: translateY(-2px);
    }

    .logo-img {
      height: 50px;
      width: auto;
      object-fit: contain;
    }

    .logo-text {
      font-family: var(--font-display);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--negro);
      line-height: 1.3;
      max-width: 180px;
    }

    .header-title {
      text-align: center;
      flex: 1;
      min-width: 300px;
    }

    .header-title h1 {
      font-family: var(--font-display);
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      line-height: 1.1;
    }

    .header-title p {
      font-size: 1.125rem;
      opacity: 0.95;
      font-weight: 400;
    }

    .user-info {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 0.75rem 1.25rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 0.875rem;
      white-space: nowrap;
    }

    /* ==================== NAVIGATION ==================== */
    .nav-bar {
      background: var(--blanco);
      border-bottom: 1px solid var(--gris-claro);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .nav-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .nav-breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--gris-medio);
    }

    .nav-breadcrumb a {
      color: var(--verde-udea);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }

    .nav-breadcrumb a:hover {
      color: var(--verde-claro);
    }

    .nav-breadcrumb span {
      opacity: 0.5;
    }

    .nav-actions {
      display: flex;
      gap: 1rem;
    }

    .btn {
      padding: 0.625rem 1.25rem;
      border: none;
      border-radius: 8px;
      font-family: var(--font-body);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--verde-udea);
      color: var(--blanco);
    }

    .btn-primary:hover {
      background: var(--verde-claro);
      transform: translateY(-1px);
      box-shadow: var(--sombra);
    }

    .btn-secondary {
      background: var(--gris-claro);
      color: var(--negro);
    }

    .btn-secondary:hover {
      background: #d1cfc9;
    }

    /* ‚≠ê NUEVO: Estilos adicionales para botones del m√≥dulo */
    .btn-danger {
      background: var(--rojo);
      color: var(--blanco);
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .btn-icon {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      padding: 0.25rem;
      transition: transform 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon:hover {
      transform: scale(1.2);
    }
    /* Fin de estilos de botones */

    /* ==================== MAIN CONTENT ==================== */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .dashboard-header {
      margin-bottom: 2rem;
      animation: fadeInUp 0.6s ease;
    }

    .dashboard-title {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--negro);
      margin-bottom: 0.5rem;
    }

    .dashboard-subtitle {
      color: var(--gris-medio);
      font-size: 1rem;
    }

    /* ==================== MODULE GRID ==================== */
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 1.5rem;
      animation: fadeIn 0.8s ease;
    }

    .module-card {
      background: var(--blanco);
      border-radius: 16px;
      padding: 2rem;
      box-shadow: var(--sombra);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border: 2px solid transparent;
    }

    .module-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--verde-udea);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .module-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--sombra-lg);
      border-color: var(--verde-udea);
    }

    .module-card:hover::before {
      transform: scaleY(1);
    }

    .module-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--verde-udea), var(--verde-claro));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin-bottom: 1.25rem;
      box-shadow: 0 4px 12px rgba(0, 99, 65, 0.2);
    }

    .module-title {
      font-family: var(--font-display);
      font-size: 1.375rem;
      font-weight: 600;
      color: var(--negro);
      margin-bottom: 0.5rem;
    }

    .module-description {
      color: var(--gris-medio);
      font-size: 0.875rem;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .module-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 1rem;
      border-top: 1px solid var(--gris-claro);
    }

    .module-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--verde-udea);
    }

    .status-dot.pending {
      background: #f59e0b;
    }

    .module-arrow {
      color: var(--verde-udea);
      font-size: 1.25rem;
      transition: transform 0.3s ease;
    }

    .module-card:hover .module-arrow {
      transform: translateX(4px);
    }

    /* ==================== STATS BAR ==================== */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
      animation: fadeInUp 0.6s ease 0.2s both;
    }

    .stat-card {
      background: var(--blanco);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: var(--sombra);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--verde-udea), var(--verde-claro));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .stat-content {
      flex: 1;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--gris-medio);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-family: var(--font-display);
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--negro);
      line-height: 1;
    }

    /* ‚≠ê NUEVO: Stat subtitle para el m√≥dulo de inventario */
    .stat-subtitle {
      font-size: 0.75rem;
      color: var(--gris-medio);
      margin-top: 0.5rem;
    }
    /* Fin de stat subtitle */

    /* ==================== MODULE VIEW ==================== */
    .module-view {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .module-view.active {
      display: block;
    }

    .module-header {
      background: var(--blanco);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: var(--sombra);
      margin-bottom: 2rem;
    }

    .module-header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .module-header h2 {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--negro);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .module-content {
      background: var(--blanco);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: var(--sombra);
      min-height: 400px;
    }

    .placeholder-content {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--gris-medio);
    }

    .placeholder-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    /* ‚≠ê NUEVOS ESTILOS DEL M√ìDULO DE INVENTARIO */
    
    /* Tabs */
    .tabs {
      background: var(--blanco);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 2rem;
      box-shadow: var(--sombra);
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      border: 2px solid transparent;
      background: transparent;
      border-radius: 8px;
      font-family: var(--font-body);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--gris-medio);
    }

    .tab-button:hover {
      background: var(--crema);
      color: var(--negro);
    }

    .tab-button.active {
      background: var(--verde-udea);
      color: var(--blanco);
      border-color: var(--verde-udea);
    }

    /* Content sections */
    .content-section {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .content-section.active {
      display: block;
    }

    .card {
      background: var(--blanco);
      padding: 2rem;
      border-radius: 12px;
      box-shadow: var(--sombra);
      margin-bottom: 2rem;
    }

    .card-title {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--negro);
    }

    /* Forms */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-group label {
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--negro);
    }

    .form-group label .required {
      color: var(--rojo);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.75rem;
      border: 2px solid var(--gris-claro);
      border-radius: 8px;
      font-family: var(--font-body);
      font-size: 1rem;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--verde-udea);
      box-shadow: 0 0 0 3px rgba(0, 99, 65, 0.1);
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .filter-group label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gris-medio);
    }

    .filter-group select,
    .filter-group input {
      padding: 0.5rem 1rem;
      border: 2px solid var(--gris-claro);
      border-radius: 8px;
      font-size: 0.875rem;
    }

    /* Table */
    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid var(--gris-claro);
      margin-bottom: 1rem;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--blanco);
    }

    .data-table thead {
      background: var(--verde-udea);
      color: var(--blanco);
    }

    .data-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
    }

    .data-table td {
      padding: 1rem;
      border-top: 1px solid var(--gris-claro);
    }

    .data-table tbody tr:hover {
      background: var(--crema);
    }

    .table-actions {
      display: flex;
      gap: 0.5rem;
    }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-cria { background: #dbeafe; color: #1e40af; }
    .badge-recria { background: #e0e7ff; color: #4338ca; }
    .badge-levante { background: #fef3c7; color: #92400e; }
    .badge-novilla { background: #fce7f3; color: #9f1239; }
    .badge-produccion { background: #d1fae5; color: #065f46; }
    .badge-secas { background: #f3f4f6; color: #374151; }
    .badge-activo { background: #d1fae5; color: #065f46; }
    .badge-vendido { background: #fee2e2; color: #991b1b; }
    .badge-muerto { background: #f3f4f6; color: #374151; }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--gris-medio);
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .empty-state h3 {
      font-family: var(--font-display);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--negro);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--blanco);
      border-radius: 16px;
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--sombra-lg);
      animation: fadeIn 0.3s ease;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-family: var(--font-display);
      font-size: 1.75rem;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gris-medio);
      padding: 0.25rem;
    }

    .modal-close:hover {
      color: var(--negro);
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--blanco);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: var(--sombra-lg);
      border-left: 4px solid var(--verde-udea);
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 400px;
    }

    .notification.success {
      border-left-color: #10b981;
    }

    .notification.error {
      border-left-color: var(--rojo);
    }

    .notification.warning {
      border-left-color: var(--amarillo);
    }
    
    /* Fin de estilos del m√≥dulo de inventario */

    /* ==================== ANIMATIONS ==================== */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
      .header {
        padding: 1.5rem 1rem 2rem;
      }

      .header-top {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-title h1 {
        font-size: 2rem;
      }

      .logos {
        width: 100%;
      }

      .logo-container {
        flex: 1;
        min-width: 140px;
      }

      .nav-bar {
        padding: 1rem;
      }

      .nav-content {
        flex-direction: column;
        align-items: flex-start;
      }

      .main-container {
        padding: 1rem;
      }

      .modules-grid {
        grid-template-columns: 1fr;
      }

      .stats-bar {
        grid-template-columns: 1fr;
      }

      /* ‚≠ê NUEVO: Responsive para m√≥dulo de inventario */
      .form-grid {
        grid-template-columns: 1fr;
      }

      .tabs {
        overflow-x: auto;
      }

      .notification {
        left: 1rem;
        right: 1rem;
      }
      /* Fin de responsive para inventario */
    }

    /* ==================== UTILITY CLASSES ==================== */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mt-1 { margin-top: 0.5rem; }
    .mt-2 { margin-top: 1rem; }
    .mt-3 { margin-top: 1.5rem; }
    .mb-1 { margin-bottom: 0.5rem; }
    .mb-2 { margin-bottom: 1rem; }
    .mb-3 { margin-bottom: 1.5rem; }
  </style>
</head>
<body>

  <!-- ==================== HEADER ==================== -->
  <header class="header">
    <div class="header-content">
      <div class="header-top">
        <div class="logos">
          <!-- ‚≠ê TUS CAMBIOS: Solo logo de la facultad a 100px de altura -->
          <div class="logo-container">
            <img src="assets/img/facultad.png" alt="Facultad de Ciencias Agrarias" style="height: 100px; width: auto; object-fit: contain;">
          </div>
          <!-- Fin de tus cambios en logos -->
        </div>

        <div class="header-title">
          <h1>Hacienda La Monta√±a</h1>
          <p>Sistema de Gesti√≥n de Costos</p>
        </div>

        <div class="user-info">
          üìÖ Febrero 2026<br>
          üë§ Usuario: Admin
        </div>
      </div>
    </div>
  </header>

  <!-- ==================== NAVIGATION BAR ==================== -->
  <nav class="nav-bar">
    <div class="nav-content">
      <div class="nav-breadcrumb">
        <a href="#" onclick="showDashboard(); return false;">üè† Dashboard</a>
        <span id="breadcrumb-separator" class="hidden">‚Ä∫</span>
        <span id="breadcrumb-current" class="hidden"></span>
      </div>
      <div class="nav-actions">
        <button class="btn btn-secondary" onclick="showDashboard()">
          ‚Üê Volver al Dashboard
        </button>
        <button class="btn btn-primary">
          üíæ Guardar Cambios
        </button>
      </div>
    </div>
  </nav>

  <!-- ==================== MAIN CONTAINER ==================== -->
  <main class="main-container">
    
    <!-- ==================== DASHBOARD VIEW ==================== -->
    <div id="dashboard-view">
      
      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-content">
            <div class="stat-label">M√≥dulos</div>
            <div class="stat-value">9</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-content">
            <div class="stat-label">Configurados</div>
            <!-- ‚≠ê CAMBIO: Actualizado a 1 porque ya tenemos el m√≥dulo de inventario -->
            <div class="stat-value">1</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚è≥</div>
          <div class="stat-content">
            <div class="stat-label">Pendientes</div>
            <!-- ‚≠ê CAMBIO: Actualizado a 8 -->
            <div class="stat-value">8</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-content">
            <div class="stat-label">Progreso</div>
            <!-- ‚≠ê CAMBIO: Actualizado a 11% (1 de 9 m√≥dulos) -->
            <div class="stat-value">11%</div>
          </div>
        </div>
      </div>

      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <h2 class="dashboard-title">M√≥dulos del Sistema</h2>
        <p class="dashboard-subtitle">Seleccione un m√≥dulo para comenzar a trabajar</p>
      </div>

      <!-- Modules Grid -->
      <div class="modules-grid">
        
        <!-- M√≥dulo 1: Inventario de Animales -->
        <!-- ‚≠ê CAMBIO: Status cambiado a "activo" (verde) -->
        <div class="module-card" onclick="openModule('inventario')">
          <div class="module-icon">üêÑ</div>
          <h3 class="module-title">Inventario de Animales</h3>
          <p class="module-description">Gesti√≥n de animales por etapa: Cr√≠a, Recr√≠a, Levante, Novilla Vientre, Producci√≥n y Secas.</p>
          <div class="module-meta">
            <div class="module-status">
              <!-- ‚≠ê Status verde (activo) en lugar de amarillo (pendiente) -->
              <span class="status-dot"></span>
              <span>Activo</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 2: Estructura de Costos -->
        <div class="module-card" onclick="openModule('estructura-costos')">
          <div class="module-icon">üìä</div>
          <h3 class="module-title">Estructura de Costos</h3>
          <p class="module-description">Clasificaci√≥n de costos directos e indirectos, variables y fijos por etapa del ganado.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 3: Recursos por Etapa -->
        <div class="module-card" onclick="openModule('recursos-etapa')">
          <div class="module-icon">üìã</div>
          <h3 class="module-title">Recursos por Etapa</h3>
          <p class="module-description">Control de recursos consumidos por cada etapa: alimentaci√≥n, sanidad, mano de obra.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 4: Producci√≥n de Leche -->
        <div class="module-card" onclick="openModule('produccion-leche')">
          <div class="module-icon">ü•õ</div>
          <h3 class="module-title">Producci√≥n de Leche</h3>
          <p class="module-description">Registro diario de producci√≥n, c√°lculo de costo por litro y an√°lisis de rentabilidad.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 5: Costo de Concentrado -->
        <div class="module-card" onclick="openModule('costo-concentrado')">
          <div class="module-icon">üåæ</div>
          <h3 class="module-title">Costo de Concentrado</h3>
          <p class="module-description">Desglose de materias primas y c√°lculo del costo por kilogramo de alimento.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 6: Potreros y Pastos -->
        <div class="module-card" onclick="openModule('potreros')">
          <div class="module-icon">üå±</div>
          <h3 class="module-title">Potreros y Pastos</h3>
          <p class="module-description">Gesti√≥n de potreros, fertilizaci√≥n, fumigaci√≥n y producci√≥n de forraje verde.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 7: Personal -->
        <div class="module-card" onclick="openModule('personal')">
          <div class="module-icon">üë•</div>
          <h3 class="module-title">Personal</h3>
          <p class="module-description">Presupuesto de costos de personal, n√≥mina, prestaciones y asignaci√≥n a actividades.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 8: Sanidad y Reproducci√≥n -->
        <div class="module-card" onclick="openModule('sanidad')">
          <div class="module-icon">üíâ</div>
          <h3 class="module-title">Sanidad y Reproducci√≥n</h3>
          <p class="module-description">Plan sanitario, vacunaci√≥n, desparasitaci√≥n, control reproductivo e inseminaci√≥n.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

        <!-- M√≥dulo 9: Reportes y An√°lisis -->
        <div class="module-card" onclick="openModule('reportes')">
          <div class="module-icon">üìà</div>
          <h3 class="module-title">Reportes y An√°lisis</h3>
          <p class="module-description">Dashboard ejecutivo, indicadores de gesti√≥n, comparativos y exportaci√≥n de datos.</p>
          <div class="module-meta">
            <div class="module-status">
              <span class="status-dot pending"></span>
              <span>Pendiente</span>
            </div>
            <span class="module-arrow">‚Üí</span>
          </div>
        </div>

      </div>
    </div>

    <!-- ==================== MODULE VIEWS ==================== -->
    
    <!-- ‚≠ê‚≠ê‚≠ê M√ìDULO COMPLETAMENTE NUEVO: INVENTARIO DE ANIMALES ‚≠ê‚≠ê‚≠ê -->
    <!-- Este es TODO el c√≥digo del m√≥dulo de inventario funcional -->
    <div id="module-inventario" class="module-view">
      
      <!-- Estad√≠sticas del m√≥dulo -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-icon">üêÑ</div>
          <div class="stat-content">
            <div class="stat-label">Total Animales</div>
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-subtitle">En todas las etapas</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ü•õ</div>
          <div class="stat-content">
            <div class="stat-label">En Producci√≥n</div>
            <div class="stat-value" id="stat-produccion">0</div>
            <div class="stat-subtitle">Vacas en orde√±o</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìÖ</div>
          <div class="stat-content">
            <div class="stat-label">Promedio D√≠as/Etapa</div>
            <div class="stat-value" id="stat-promedio">0</div>
            <div class="stat-subtitle">Duraci√≥n promedio</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚ö†Ô∏è</div>
          <div class="stat-content">
            <div class="stat-label">Pr√≥ximos Cambios</div>
            <div class="stat-value" id="stat-proximos">0</div>
            <div class="stat-subtitle">En los pr√≥ximos 30 d√≠as</div>
          </div>
        </div>
      </div>

      <!-- Tabs del m√≥dulo -->
      <div class="tabs">
        <button class="tab-button active" onclick="switchTab('registro')">
          ‚ûï Registrar Animal
        </button>
        <button class="tab-button" onclick="switchTab('inventario')">
          üìã Inventario Actual
        </button>
        <button class="tab-button" onclick="switchTab('movimientos')">
          üîÑ Movimientos
        </button>
        <button class="tab-button" onclick="switchTab('reportes')">
          üìä Reportes
        </button>
      </div>

      <!-- Tab 1: Registro -->
      <div id="tab-registro" class="content-section active">
        <div class="card">
          <h2 class="card-title">Registrar Nuevo Animal</h2>
          
          <form id="form-registro">
            <div class="form-grid">
              <div class="form-group">
                <label>ID del Animal <span class="required">*</span></label>
                <input type="text" id="animal-id" name="id" placeholder="A001" required>
              </div>

              <div class="form-group">
                <label>Nombre/Identificaci√≥n</label>
                <input type="text" id="animal-nombre" name="nombre" placeholder="Vaca 1">
              </div>

              <div class="form-group">
                <label>Fecha de Nacimiento <span class="required">*</span></label>
                <input type="date" id="animal-fecha-nac" name="fecha_nacimiento" required>
              </div>

              <div class="form-group">
                <label>Etapa Actual <span class="required">*</span></label>
                <select id="animal-etapa" name="etapa" required>
                  <option value="">Seleccione...</option>
                  <option value="Cr√≠a">Cr√≠a (0-3 meses)</option>
                  <option value="Recr√≠a">Recr√≠a (3-8 meses)</option>
                  <option value="Levante">Levante (8-16 meses)</option>
                  <option value="Novilla Vientre">Novilla Vientre (16 meses - Parto)</option>
                  <option value="Producci√≥n">Producci√≥n</option>
                  <option value="Secas">Secas</option>
                </select>
              </div>

              <div class="form-group">
                <label>Potrero Asignado</label>
                <input type="text" id="animal-potrero" name="potrero" placeholder="P15-1">
              </div>

              <div class="form-group">
                <label>Origen</label>
                <select id="animal-origen" name="origen">
                  <option value="">Seleccione...</option>
                  <option value="Nacimiento">Nacimiento en la hacienda</option>
                  <option value="Compra">Compra</option>
                  <option value="Donaci√≥n">Donaci√≥n</option>
                </select>
              </div>

              <div class="form-group full-width">
                <label>Observaciones</label>
                <textarea id="animal-observaciones" name="observaciones" rows="3" placeholder="Caracter√≠sticas especiales, historial m√©dico, etc."></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button type="reset" class="btn btn-secondary">Limpiar</button>
              <button type="submit" class="btn btn-primary">üíæ Guardar Animal</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Tab 2: Inventario -->
      <div id="tab-inventario" class="content-section">
        <div class="card">
          <h2 class="card-title">Inventario Actual</h2>
          
          <!-- Filtros -->
          <div class="filters">
            <div class="filter-group">
              <label>Etapa</label>
              <select id="filter-etapa" onchange="filtrarInventario()">
                <option value="">Todas las etapas</option>
                <option value="Cr√≠a">Cr√≠a</option>
                <option value="Recr√≠a">Recr√≠a</option>
                <option value="Levante">Levante</option>
                <option value="Novilla Vientre">Novilla Vientre</option>
                <option value="Producci√≥n">Producci√≥n</option>
                <option value="Secas">Secas</option>
              </select>
            </div>

            <div class="filter-group">
              <label>Estado</label>
              <select id="filter-estado" onchange="filtrarInventario()">
                <option value="">Todos</option>
                <option value="Activo">Activo</option>
                <option value="Vendido">Vendido</option>
                <option value="Muerto">Muerto</option>
              </select>
            </div>

            <div class="filter-group">
              <label>Buscar</label>
              <input type="text" id="filter-buscar" placeholder="ID o nombre..." oninput="filtrarInventario()">
            </div>

            <div style="margin-left: auto;">
              <button class="btn btn-secondary btn-small" onclick="exportarCSV()">
                üì• Exportar CSV
              </button>
            </div>
          </div>

          <!-- Tabla -->
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Etapa</th>
                  <th>Edad</th>
                  <th>D√≠as en Etapa</th>
                  <th>Potrero</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="tabla-inventario">
                <!-- Se llenar√° con JavaScript -->
              </tbody>
            </table>
          </div>

          <div id="empty-inventario" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üêÑ</div>
            <h3>No hay animales registrados</h3>
            <p>Comienza registrando tu primer animal en la pesta√±a "Registrar Animal"</p>
          </div>
        </div>
      </div>

      <!-- Tab 3: Movimientos -->
      <div id="tab-movimientos" class="content-section">
        <div class="card">
          <h2 class="card-title">Historial de Movimientos</h2>
          
          <div class="filters">
            <div class="filter-group">
              <label>Tipo de Movimiento</label>
              <select id="filter-tipo-mov" onchange="filtrarMovimientos()">
                <option value="">Todos</option>
                <option value="Cambio Etapa">Cambio de Etapa</option>
                <option value="Venta">Venta</option>
                <option value="Muerte">Muerte</option>
                <option value="Compra">Compra</option>
              </select>
            </div>

            <div class="filter-group">
              <label>Desde</label>
              <input type="date" id="filter-fecha-desde" onchange="filtrarMovimientos()">
            </div>

            <div class="filter-group">
              <label>Hasta</label>
              <input type="date" id="filter-fecha-hasta" onchange="filtrarMovimientos()">
            </div>
          </div>

          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Animal</th>
                  <th>Tipo</th>
                  <th>Detalle</th>
                  <th>Observaciones</th>
                </tr>
              </thead>
              <tbody id="tabla-movimientos">
                <!-- Se llenar√° con JavaScript -->
              </tbody>
            </table>
          </div>

          <div id="empty-movimientos" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üîÑ</div>
            <h3>No hay movimientos registrados</h3>
            <p>Los movimientos se registran autom√°ticamente al cambiar etapas o estados</p>
          </div>
        </div>
      </div>

      <!-- Tab 4: Reportes -->
      <div id="tab-reportes" class="content-section">
        <div class="card">
          <h2 class="card-title">Reportes por Etapa</h2>
          
          <div class="stats-bar">
            <div class="stat-card">
              <div class="stat-label">Cr√≠a (0-3m)</div>
              <div class="stat-value" id="report-cria">0</div>
              <div class="stat-subtitle" id="report-cria-subtitle">animales</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Recr√≠a (3-8m)</div>
              <div class="stat-value" id="report-recria">0</div>
              <div class="stat-subtitle" id="report-recria-subtitle">animales</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Levante (8-16m)</div>
              <div class="stat-value" id="report-levante">0</div>
              <div class="stat-subtitle" id="report-levante-subtitle">animales</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Novilla Vientre</div>
              <div class="stat-value" id="report-novilla">0</div>
              <div class="stat-subtitle" id="report-novilla-subtitle">animales</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Producci√≥n</div>
              <div class="stat-value" id="report-produccion">0</div>
              <div class="stat-subtitle" id="report-produccion-subtitle">animales</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Secas</div>
              <div class="stat-value" id="report-secas">0</div>
              <div class="stat-subtitle" id="report-secas-subtitle">animales</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">Alertas y Recomendaciones</h2>
          <div id="alertas-container">
            <!-- Se llenar√° con JavaScript -->
          </div>
        </div>
      </div>

    </div>
    <!-- ‚≠ê‚≠ê‚≠ê FIN DEL M√ìDULO DE INVENTARIO ‚≠ê‚≠ê‚≠ê -->

    <!-- M√≥dulo: Estructura de Costos -->
    <div id="module-estructura-costos" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üìä Estructura de Costos por Etapa</h2>
        </div>
        <p style="color: var(--gris-medio);">Clasificaci√≥n detallada de costos directos, indirectos, variables y fijos</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üìä</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° la estructura completa de costos del Excel original.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Recursos por Etapa -->
    <div id="module-recursos-etapa" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üìã Recursos por Etapa</h2>
        </div>
        <p style="color: var(--gris-medio);">Control de consumo de recursos por cada etapa del ganado</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üìã</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° el control de recursos consumidos por etapa.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Producci√≥n de Leche -->
    <div id="module-produccion-leche" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>ü•õ Producci√≥n de Leche</h2>
        </div>
        <p style="color: var(--gris-medio);">Registro y an√°lisis de producci√≥n diaria de leche</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">ü•õ</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° registro diario y c√°lculo de costo por litro.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Costo de Concentrado -->
    <div id="module-costo-concentrado" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üåæ Costo de Concentrado</h2>
        </div>
        <p style="color: var(--gris-medio);">Desglose de materias primas y c√°lculo de costo por kg</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üåæ</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° el desglose completo del costo de concentrado.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Potreros y Pastos -->
    <div id="module-potreros" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üå± Potreros y Pastos</h2>
        </div>
        <p style="color: var(--gris-medio);">Gesti√≥n de potreros, fertilizaci√≥n y producci√≥n de forraje</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üå±</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° la gesti√≥n completa de potreros.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Personal -->
    <div id="module-personal" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üë• Personal</h2>
        </div>
        <p style="color: var(--gris-medio);">Presupuesto y control de costos de personal</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üë•</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° la gesti√≥n completa de personal.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Sanidad y Reproducci√≥n -->
    <div id="module-sanidad" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üíâ Sanidad y Reproducci√≥n</h2>
        </div>
        <p style="color: var(--gris-medio);">Control sanitario y reproductivo del ganado</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üíâ</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° sanidad y reproducci√≥n completa.</p>
        </div>
      </div>
    </div>

    <!-- M√≥dulo: Reportes y An√°lisis -->
    <div id="module-reportes" class="module-view">
      <div class="module-header">
        <div class="module-header-top">
          <h2>üìà Reportes y An√°lisis</h2>
        </div>
        <p style="color: var(--gris-medio);">Dashboard ejecutivo e indicadores de gesti√≥n</p>
      </div>
      <div class="module-content">
        <div class="placeholder-content">
          <div class="placeholder-icon">üìà</div>
          <h3>M√≥dulo en Construcci√≥n</h3>
          <p>Este m√≥dulo incluir√° reportes completos y dashboard ejecutivo.</p>
        </div>
      </div>
    </div>

  </main>

  <!-- ‚≠ê‚≠ê‚≠ê NUEVOS MODALES DEL M√ìDULO DE INVENTARIO ‚≠ê‚≠ê‚≠ê -->
  <!-- Modal para cambiar etapa -->
  <div id="modal-cambiar-etapa" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Cambiar Etapa</h3>
        <button class="modal-close" onclick="cerrarModal('modal-cambiar-etapa')">‚úï</button>
      </div>

      <form id="form-cambiar-etapa">
        <input type="hidden" id="cambio-animal-id">
        
        <div class="form-group">
          <label>Animal: <strong id="cambio-animal-nombre"></strong></label>
          <p style="color: var(--gris-medio); font-size: 0.875rem;">
            Etapa actual: <span id="cambio-etapa-actual"></span>
          </p>
        </div>

        <div class="form-group">
          <label>Nueva Etapa <span class="required">*</span></label>
          <select id="cambio-nueva-etapa" required>
            <option value="">Seleccione...</option>
            <option value="Cr√≠a">Cr√≠a (0-3 meses)</option>
            <option value="Recr√≠a">Recr√≠a (3-8 meses)</option>
            <option value="Levante">Levante (8-16 meses)</option>
            <option value="Novilla Vientre">Novilla Vientre (16 meses - Parto)</option>
            <option value="Producci√≥n">Producci√≥n</option>
            <option value="Secas">Secas</option>
          </select>
        </div>

        <div class="form-group">
          <label>Fecha del Cambio</label>
          <input type="date" id="cambio-fecha" value="">
        </div>

        <div class="form-group">
          <label>Observaciones</label>
          <textarea id="cambio-observaciones" rows="3"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="cerrarModal('modal-cambiar-etapa')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Confirmar Cambio</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para cambiar estado -->
  <div id="modal-cambiar-estado" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Cambiar Estado</h3>
        <button class="modal-close" onclick="cerrarModal('modal-cambiar-estado')">‚úï</button>
      </div>

      <form id="form-cambiar-estado">
        <input type="hidden" id="estado-animal-id">
        
        <div class="form-group">
          <label>Animal: <strong id="estado-animal-nombre"></strong></label>
        </div>

        <div class="form-group">
          <label>Nuevo Estado <span class="required">*</span></label>
          <select id="estado-nuevo-estado" required onchange="toggleCamposEstado()">
            <option value="">Seleccione...</option>
            <option value="Vendido">Vendido</option>
            <option value="Muerto">Muerto</option>
            <option value="Activo">Reactivar (volver a Activo)</option>
          </select>
        </div>

        <div class="form-group" id="campo-precio-venta" style="display: none;">
          <label>Precio de Venta</label>
          <input type="number" id="estado-precio-venta" step="0.01" placeholder="0.00">
        </div>

        <div class="form-group">
          <label>Fecha</label>
          <input type="date" id="estado-fecha" value="">
        </div>

        <div class="form-group">
          <label>Observaciones</label>
          <textarea id="estado-observaciones" rows="3"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="cerrarModal('modal-cambiar-estado')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Confirmar</button>
        </div>
      </form>
    </div>
  </div>
  <!-- ‚≠ê‚≠ê‚≠ê FIN DE MODALES ‚≠ê‚≠ê‚≠ê -->

  <!-- ==================== JAVASCRIPT ==================== -->
  <script>
    // ==================== SISTEMA DE NAVEGACI√ìN (Original) ====================
    
    const appState = {
      currentModule: null,
      modules: {
        'inventario': 'Inventario de Animales',
        'estructura-costos': 'Estructura de Costos',
        'recursos-etapa': 'Recursos por Etapa',
        'produccion-leche': 'Producci√≥n de Leche',
        'costo-concentrado': 'Costo de Concentrado',
        'potreros': 'Potreros y Pastos',
        'personal': 'Personal',
        'sanidad': 'Sanidad y Reproducci√≥n',
        'reportes': 'Reportes y An√°lisis'
      }
    };

    function openModule(moduleId) {
      document.getElementById('dashboard-view').classList.add('hidden');
      
      document.querySelectorAll('.module-view').forEach(view => {
        view.classList.remove('active');
      });
      
      const moduleView = document.getElementById(`module-${moduleId}`);
      if (moduleView) {
        moduleView.classList.add('active');
      }
      
      document.getElementById('breadcrumb-separator').classList.remove('hidden');
      document.getElementById('breadcrumb-current').classList.remove('hidden');
      document.getElementById('breadcrumb-current').textContent = appState.modules[moduleId];
      
      appState.currentModule = moduleId;
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      // ‚≠ê NUEVO: Cargar datos del m√≥dulo de inventario cuando se abre
      if (moduleId === 'inventario') {
        actualizarEstadisticas();
        renderizarInventario();
      }
    }

    function showDashboard() {
      document.querySelectorAll('.module-view').forEach(view => {
        view.classList.remove('active');
      });
      
      document.getElementById('dashboard-view').classList.remove('hidden');
      
      document.getElementById('breadcrumb-separator').classList.add('hidden');
      document.getElementById('breadcrumb-current').classList.add('hidden');
      
      appState.currentModule = null;
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    const DataStore = {
      save: function(key, data) {
        try {
          localStorage.setItem(`hacienda_${key}`, JSON.stringify(data));
          return true;
        } catch (e) {
          console.error('Error guardando datos:', e);
          return false;
        }
      },
      
      load: function(key) {
        try {
          const data = localStorage.getItem(`hacienda_${key}`);
          return data ? JSON.parse(data) : null;
        } catch (e) {
          console.error('Error cargando datos:', e);
          return null;
        }
      }
    };

    // ‚≠ê‚≠ê‚≠ê NUEVO: TODO EL JAVASCRIPT DEL M√ìDULO DE INVENTARIO ‚≠ê‚≠ê‚≠ê
    
    // Estado de datos del m√≥dulo
    let inventario = DataStore.load('inventario') || [];
    let movimientos = DataStore.load('movimientos') || [];
    let configuracion = DataStore.load('config') || {
      duraciones_etapas: {
        'Cr√≠a': 90,
        'Recr√≠a': 150,
        'Levante': 240,
        'Novilla Vientre': 365,
        'Producci√≥n': 305,
        'Secas': 60
      }
    };

    // Funciones de utilidad
    function calcularEdad(fechaNacimiento) {
      const hoy = new Date();
      const nacimiento = new Date(fechaNacimiento);
      const diff = hoy - nacimiento;
      const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
      
      if (dias < 30) return `${dias} d√≠as`;
      if (dias < 365) return `${Math.floor(dias / 30)} meses`;
      const a√±os = Math.floor(dias / 365);
      const meses = Math.floor((dias % 365) / 30);
      return `${a√±os}a ${meses}m`;
    }

    function calcularDiasEnEtapa(animal) {
      const hoy = new Date();
      const ingreso = new Date(animal.fecha_ingreso_etapa || animal.fecha_registro);
      const diff = hoy - ingreso;
      return Math.floor(diff / (1000 * 60 * 60 * 24));
    }

    function obtenerBadgeEtapa(etapa) {
      const badges = {
        'Cr√≠a': 'badge-cria',
        'Recr√≠a': 'badge-recria',
        'Levante': 'badge-levante',
        'Novilla Vientre': 'badge-novilla',
        'Producci√≥n': 'badge-produccion',
        'Secas': 'badge-secas'
      };
      return badges[etapa] || 'badge-cria';
    }

    function obtenerBadgeEstado(estado) {
      const badges = {
        'Activo': 'badge-activo',
        'Vendido': 'badge-vendido',
        'Muerto': 'badge-muerto'
      };
      return badges[estado] || 'badge-activo';
    }

    function mostrarNotificacion(mensaje, tipo = 'success') {
      const notif = document.createElement('div');
      notif.className = `notification ${tipo}`;
      notif.innerHTML = `
        <strong>${tipo === 'success' ? '‚úì' : tipo === 'error' ? '‚úó' : '‚Ñπ'}</strong>
        ${mensaje}
      `;
      document.body.appendChild(notif);
      
      setTimeout(() => {
        notif.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notif.remove(), 300);
      }, 3000);
    }

    function generarID() {
      const num = inventario.length + 1;
      return `A${num.toString().padStart(3, '0')}`;
    }

    function formatearFecha(fecha) {
      if (!fecha) return '-';
      const date = new Date(fecha);
      return date.toLocaleDateString('es-CO');
    }

    // Cambio de tabs
    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(`tab-${tabName}`).classList.add('active');
      
      if (tabName === 'inventario') {
        renderizarInventario();
      } else if (tabName === 'movimientos') {
        renderizarMovimientos();
      } else if (tabName === 'reportes') {
        renderizarReportes();
      }
    }

    // Registro de animales
    document.addEventListener('DOMContentLoaded', function() {
      const formRegistro = document.getElementById('form-registro');
      if (formRegistro) {
        // Sugerir ID autom√°tico
        document.getElementById('animal-id').value = generarID();
        
        formRegistro.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const formData = new FormData(this);
          const datos = Object.fromEntries(formData);
          
          if (inventario.find(a => a.id === datos.id)) {
            mostrarNotificacion('Ya existe un animal con ese ID', 'error');
            return;
          }
          
          const nuevoAnimal = {
            ...datos,
            fecha_registro: new Date().toISOString().split('T')[0],
            fecha_ingreso_etapa: new Date().toISOString().split('T')[0],
            estado: 'Activo',
            historial_etapas: [{
              etapa: datos.etapa,
              fecha_inicio: new Date().toISOString().split('T')[0],
              fecha_fin: null
            }]
          };
          
          inventario.push(nuevoAnimal);
          DataStore.save('inventario', inventario);
          
          const movimiento = {
            id: Date.now(),
            fecha: nuevoAnimal.fecha_registro,
            animal_id: nuevoAnimal.id,
            animal_nombre: nuevoAnimal.nombre || nuevoAnimal.id,
            tipo: datos.origen === 'Nacimiento' ? 'Nacimiento' : 'Compra',
            detalle: `Ingreso a etapa: ${datos.etapa}`,
            observaciones: datos.observaciones || ''
          };
          
          movimientos.push(movimiento);
          DataStore.save('movimientos', movimientos);
          
          mostrarNotificacion(`Animal ${datos.id} registrado exitosamente`, 'success');
          this.reset();
          document.getElementById('animal-id').value = generarID();
          actualizarEstadisticas();
        });
      }
    });

    // Renderizar inventario
    function renderizarInventario(datos = null) {
      const tbody = document.getElementById('tabla-inventario');
      const empty = document.getElementById('empty-inventario');
      
      if (!tbody) return;
      
      const animales = datos || inventario.filter(a => a.estado === 'Activo');
      
      if (animales.length === 0) {
        tbody.innerHTML = '';
        if (empty) empty.style.display = 'block';
        return;
      }
      
      if (empty) empty.style.display = 'none';
      
      tbody.innerHTML = animales.map(animal => {
        const edad = calcularEdad(animal.fecha_nacimiento);
        const diasEtapa = calcularDiasEnEtapa(animal);
        
        return `
          <tr>
            <td><strong>${animal.id}</strong></td>
            <td>${animal.nombre || '-'}</td>
            <td><span class="badge ${obtenerBadgeEtapa(animal.etapa)}">${animal.etapa}</span></td>
            <td>${edad}</td>
            <td>${diasEtapa} d√≠as</td>
            <td>${animal.potrero || '-'}</td>
            <td><span class="badge ${obtenerBadgeEstado(animal.estado)}">${animal.estado}</span></td>
            <td class="table-actions">
              <button class="btn-icon" onclick="abrirModalCambiarEtapa('${animal.id}')" title="Cambiar etapa">
                üîÑ
              </button>
              <button class="btn-icon" onclick="abrirModalCambiarEstado('${animal.id}')" title="Cambiar estado">
                ‚öôÔ∏è
              </button>
              <button class="btn-icon" onclick="verDetalles('${animal.id}')" title="Ver detalles">
                üëÅÔ∏è
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function filtrarInventario() {
      const etapa = document.getElementById('filter-etapa')?.value;
      const estado = document.getElementById('filter-estado')?.value;
      const buscar = document.getElementById('filter-buscar')?.value.toLowerCase();
      
      let animalesFiltrados = inventario;
      
      if (etapa) {
        animalesFiltrados = animalesFiltrados.filter(a => a.etapa === etapa);
      }
      
      if (estado) {
        animalesFiltrados = animalesFiltrados.filter(a => a.estado === estado);
      }
      
      if (buscar) {
        animalesFiltrados = animalesFiltrados.filter(a => 
          a.id.toLowerCase().includes(buscar) ||
          (a.nombre && a.nombre.toLowerCase().includes(buscar))
        );
      }
      
      renderizarInventario(animalesFiltrados);
    }

    // Modal cambiar etapa
    function abrirModalCambiarEtapa(animalId) {
      const animal = inventario.find(a => a.id === animalId);
      if (!animal) return;
      
      document.getElementById('cambio-animal-id').value = animal.id;
      document.getElementById('cambio-animal-nombre').textContent = animal.nombre || animal.id;
      document.getElementById('cambio-etapa-actual').textContent = animal.etapa;
      document.getElementById('cambio-fecha').value = new Date().toISOString().split('T')[0];
      
      document.getElementById('modal-cambiar-etapa').classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
      const formCambiarEtapa = document.getElementById('form-cambiar-etapa');
      if (formCambiarEtapa) {
        formCambiarEtapa.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const animalId = document.getElementById('cambio-animal-id').value;
          const nuevaEtapa = document.getElementById('cambio-nueva-etapa').value;
          const fecha = document.getElementById('cambio-fecha').value;
          const observaciones = document.getElementById('cambio-observaciones').value;
          
          const animal = inventario.find(a => a.id === animalId);
          if (!animal) return;
          
          const etapaAnterior = animal.etapa;
          
          animal.etapa = nuevaEtapa;
          animal.fecha_ingreso_etapa = fecha;
          
          if (animal.historial_etapas) {
            const ultimaEtapa = animal.historial_etapas[animal.historial_etapas.length - 1];
            ultimaEtapa.fecha_fin = fecha;
            
            animal.historial_etapas.push({
              etapa: nuevaEtapa,
              fecha_inicio: fecha,
              fecha_fin: null
            });
          }
          
          DataStore.save('inventario', inventario);
          
          const movimiento = {
            id: Date.now(),
            fecha: fecha,
            animal_id: animal.id,
            animal_nombre: animal.nombre || animal.id,
            tipo: 'Cambio Etapa',
            detalle: `${etapaAnterior} ‚Üí ${nuevaEtapa}`,
            observaciones: observaciones
          };
          
          movimientos.push(movimiento);
          DataStore.save('movimientos', movimientos);
          
          mostrarNotificacion(`Etapa actualizada: ${nuevaEtapa}`, 'success');
          cerrarModal('modal-cambiar-etapa');
          renderizarInventario();
          actualizarEstadisticas();
          this.reset();
        });
      }
    });

    // Modal cambiar estado
    function abrirModalCambiarEstado(animalId) {
      const animal = inventario.find(a => a.id === animalId);
      if (!animal) return;
      
      document.getElementById('estado-animal-id').value = animal.id;
      document.getElementById('estado-animal-nombre').textContent = animal.nombre || animal.id;
      document.getElementById('estado-fecha').value = new Date().toISOString().split('T')[0];
      
      document.getElementById('modal-cambiar-estado').classList.add('active');
    }

    function toggleCamposEstado() {
      const estado = document.getElementById('estado-nuevo-estado')?.value;
      const campoPrecio = document.getElementById('campo-precio-venta');
      
      if (campoPrecio) {
        if (estado === 'Vendido') {
          campoPrecio.style.display = 'block';
        } else {
          campoPrecio.style.display = 'none';
        }
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const formCambiarEstado = document.getElementById('form-cambiar-estado');
      if (formCambiarEstado) {
        formCambiarEstado.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const animalId = document.getElementById('estado-animal-id').value;
          const nuevoEstado = document.getElementById('estado-nuevo-estado').value;
          const fecha = document.getElementById('estado-fecha').value;
          const observaciones = document.getElementById('estado-observaciones').value;
          const precioVenta = document.getElementById('estado-precio-venta')?.value;
          
          const animal = inventario.find(a => a.id === animalId);
          if (!animal) return;
          
          animal.estado = nuevoEstado;
          
          if (nuevoEstado === 'Vendido' && precioVenta) {
            animal.precio_venta = parseFloat(precioVenta);
            animal.fecha_venta = fecha;
          } else if (nuevoEstado === 'Muerto') {
            animal.fecha_muerte = fecha;
          }
          
          DataStore.save('inventario', inventario);
          
          const movimiento = {
            id: Date.now(),
            fecha: fecha,
            animal_id: animal.id,
            animal_nombre: animal.nombre || animal.id,
            tipo: nuevoEstado,
            detalle: nuevoEstado === 'Vendido' && precioVenta ? 
              `Vendido por $${parseFloat(precioVenta).toLocaleString()}` : 
              nuevoEstado,
            observaciones: observaciones
          };
          
          movimientos.push(movimiento);
          DataStore.save('movimientos', movimientos);
          
          mostrarNotificacion(`Estado actualizado: ${nuevoEstado}`, 'success');
          cerrarModal('modal-cambiar-estado');
          renderizarInventario();
          actualizarEstadisticas();
          this.reset();
        });
      }
    });

    // Movimientos
    function renderizarMovimientos(datos = null) {
      const tbody = document.getElementById('tabla-movimientos');
      const empty = document.getElementById('empty-movimientos');
      
      if (!tbody) return;
      
      const movs = (datos || movimientos).sort((a, b) => 
        new Date(b.fecha) - new Date(a.fecha)
      );
      
      if (movs.length === 0) {
        tbody.innerHTML = '';
        if (empty) empty.style.display = 'block';
        return;
      }
      
      if (empty) empty.style.display = 'none';
      
      tbody.innerHTML = movs.map(mov => `
        <tr>
          <td>${formatearFecha(mov.fecha)}</td>
          <td><strong>${mov.animal_nombre}</strong><br><small>${mov.animal_id}</small></td>
          <td><span class="badge badge-cria">${mov.tipo}</span></td>
          <td>${mov.detalle}</td>
          <td>${mov.observaciones || '-'}</td>
        </tr>
      `).join('');
    }

    function filtrarMovimientos() {
      const tipo = document.getElementById('filter-tipo-mov')?.value;
      const desde = document.getElementById('filter-fecha-desde')?.value;
      const hasta = document.getElementById('filter-fecha-hasta')?.value;
      
      let movsFiltrados = movimientos;
      
      if (tipo) {
        movsFiltrados = movsFiltrados.filter(m => m.tipo === tipo);
      }
      
      if (desde) {
        movsFiltrados = movsFiltrados.filter(m => m.fecha >= desde);
      }
      
      if (hasta) {
        movsFiltrados = movsFiltrados.filter(m => m.fecha <= hasta);
      }
      
      renderizarMovimientos(movsFiltrados);
    }

    // Reportes
    function renderizarReportes() {
      const activos = inventario.filter(a => a.estado === 'Activo');
      const porEtapa = {
        'Cr√≠a': activos.filter(a => a.etapa === 'Cr√≠a'),
        'Recr√≠a': activos.filter(a => a.etapa === 'Recr√≠a'),
        'Levante': activos.filter(a => a.etapa === 'Levante'),
        'Novilla Vientre': activos.filter(a => a.etapa === 'Novilla Vientre'),
        'Producci√≥n': activos.filter(a => a.etapa === 'Producci√≥n'),
        'Secas': activos.filter(a => a.etapa === 'Secas')
      };
      
      Object.keys(porEtapa).forEach(etapa => {
        const id = etapa.toLowerCase().replace(' ', '-');
        const count = porEtapa[etapa].length;
        const promedioDias = count > 0 ? 
          Math.round(porEtapa[etapa].reduce((sum, a) => sum + calcularDiasEnEtapa(a), 0) / count) : 
          0;
        
        const elem = document.getElementById(`report-${id === 'novilla-vientre' ? 'novilla' : id}`);
        const subtitle = document.getElementById(`report-${id === 'novilla-vientre' ? 'novilla' : id}-subtitle`);
        
        if (elem) elem.textContent = count;
        if (subtitle) subtitle.textContent = `${promedioDias} d√≠as promedio`;
      });
      
      // Alertas
      const alertas = [];
      const hoy = new Date();
      
      activos.forEach(animal => {
        const diasEtapa = calcularDiasEnEtapa(animal);
        const duracionEsperada = configuracion.duraciones_etapas[animal.etapa];
        
        if (diasEtapa >= duracionEsperada - 30) {
          alertas.push({
            tipo: 'warning',
            mensaje: `${animal.nombre || animal.id} lleva ${diasEtapa} d√≠as en ${animal.etapa}. Considerar cambio de etapa.`
          });
        }
      });
      
      const novillas = porEtapa['Novilla Vientre'];
      novillas.forEach(animal => {
        const edad = calcularEdad(animal.fecha_nacimiento);
        if (edad.includes('a')) {
          alertas.push({
            tipo: 'info',
            mensaje: `${animal.nombre || animal.id} (Novilla) podr√≠a estar pr√≥xima al primer parto.`
          });
        }
      });
      
      const container = document.getElementById('alertas-container');
      if (container) {
        if (alertas.length === 0) {
          container.innerHTML = '<p style="color: var(--gris-medio);">No hay alertas en este momento.</p>';
        } else {
          container.innerHTML = alertas.map(alerta => `
            <div style="padding: 1rem; background: ${alerta.tipo === 'warning' ? '#fef3c7' : '#dbeafe'}; 
                 border-left: 4px solid ${alerta.tipo === 'warning' ? '#f59e0b' : '#3b82f6'}; 
                 border-radius: 8px; margin-bottom: 1rem;">
              ${alerta.tipo === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'} ${alerta.mensaje}
            </div>
          `).join('');
        }
      }
    }

    // Estad√≠sticas
    function actualizarEstadisticas() {
      const activos = inventario.filter(a => a.estado === 'Activo');
      const produccion = activos.filter(a => a.etapa === 'Producci√≥n');
      
      const elemTotal = document.getElementById('stat-total');
      const elemProduccion = document.getElementById('stat-produccion');
      
      if (elemTotal) elemTotal.textContent = activos.length;
      if (elemProduccion) elemProduccion.textContent = produccion.length;
      
      if (activos.length > 0) {
        const promedio = Math.round(
          activos.reduce((sum, a) => sum + calcularDiasEnEtapa(a), 0) / activos.length
        );
        const elemPromedio = document.getElementById('stat-promedio');
        if (elemPromedio) elemPromedio.textContent = promedio;
      }
      
      const proximos = activos.filter(animal => {
        const diasEtapa = calcularDiasEnEtapa(animal);
        const duracionEsperada = configuracion.duraciones_etapas[animal.etapa];
        return diasEtapa >= duracionEsperada - 30;
      });
      
      const elemProximos = document.getElementById('stat-proximos');
      if (elemProximos) elemProximos.textContent = proximos.length;
    }

    // Exportar CSV
    function exportarCSV() {
      const headers = ['ID', 'Nombre', 'Etapa', 'Edad', 'D√≠as en Etapa', 'Potrero', 'Estado', 'Fecha Nacimiento', 'Fecha Registro'];
      
      const rows = inventario.map(animal => [
        animal.id,
        animal.nombre || '',
        animal.etapa,
        calcularEdad(animal.fecha_nacimiento),
        calcularDiasEnEtapa(animal),
        animal.potrero || '',
        animal.estado,
        animal.fecha_nacimiento,
        animal.fecha_registro
      ]);
      
      const csv = [headers, ...rows]
        .map(row => row.map(cell => `"${cell}"`).join(','))
        .join('\n');
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `inventario_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      
      URL.revokeObjectURL(url);
      mostrarNotificacion('Archivo CSV exportado', 'success');
    }

    // Cerrar modales
    function cerrarModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });
    });

    // Ver detalles
    function verDetalles(animalId) {
      const animal = inventario.find(a => a.id === animalId);
      if (!animal) return;
      
      alert(`
DETALLES DEL ANIMAL

ID: ${animal.id}
Nombre: ${animal.nombre || '-'}
Etapa: ${animal.etapa}
Edad: ${calcularEdad(animal.fecha_nacimiento)}
D√≠as en etapa actual: ${calcularDiasEnEtapa(animal)} d√≠as
Potrero: ${animal.potrero || '-'}
Estado: ${animal.estado}
Fecha nacimiento: ${formatearFecha(animal.fecha_nacimiento)}
Fecha registro: ${formatearFecha(animal.fecha_registro)}
Observaciones: ${animal.observaciones || '-'}
      `);
    }

    // ‚≠ê‚≠ê‚≠ê FIN DEL JAVASCRIPT DEL M√ìDULO DE INVENTARIO ‚≠ê‚≠ê‚≠ê

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Sistema de Costos - Hacienda La Monta√±a');
      console.log('M√≥dulos disponibles:', Object.keys(appState.modules).length);
      console.log('Animales en inventario:', inventario.length);
      
      showDashboard();
    });
  </script>

</body>
</html>
